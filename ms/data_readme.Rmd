---
output: rtf_document
editor_options:
  chunk_output_type: console
---

---
bibliography: 
- `r here::here("ms/references.yaml")`
---

```{r manual, include = FALSE, evaluate = FALSE}
# Run these lines if rendering outside of targets plan
library(targets)
library(tarchetypes)
source(here::here("R/packages.R"))
source(here::here("R/functions.R"))
source(here::here("R/ms_functions.R"))
```

```{r setup, include = FALSE, cache = FALSE}
# TO CONVERT TO PLAIN TEXT:
# after rendering to rtf,
# 1. Copy the contents of the rtf file, paste to txt.
# 2. Replace all single line breaks with double line breaks
# (in Atom search-replace with grep: \n for \n\n)
# 3. Hard-wrap all text at 80 characters (in Atom with autoflow: cmd-alt-q)
# (optional: add name after first line)
# 4. Save as "README.txt"

knitr::opts_chunk$set(
  echo = FALSE, message = FALSE,
  warning = FALSE, results = "hide", cache = FALSE)

# Load objects from targets workflow (all paths to data files)
tar_load(
  c(
    "ms_functions",
    "japan_ferns_comm_full_file",
    "inext_res_file",
    "occ_point_data_summary_file",
    "plastome_calibration_dates",
    "redundancy_by_res_file",
    "japan_ferns_shape_full_file"
    )
  )
```

This README.txt file was generated on `r format(Sys.time(), '%d %B, %Y')`

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\- GENERAL INFORMATION \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

Title of Dataset: Data from: Spatial phylogenetics of Japanese ferns: Patterns,
processes, and implications for conservation

Author Information

Principal Investigator: Joel H. Nitta

Department of Biological Sciences, Graduate School of Science, The University of
Tokyo, 2-11-16 Yayoi, Bunkyo-ku, Tokyo 113-0032, Japan joelnitta@gmail.com

Associate or Co-investigators: Brent D. Mishler, Wataru Iwasaki, Atsushi Ebihara

Date of data collection: 2012--2014

Geographic location of data collection: Japan

Information about funding sources or sponsorship that supported the collection
of the data: Funding provided in part by the Japan Society for the Promotion of
Science (Kakenhi) Grant Number 16H06279

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

SHARING/ACCESS INFORMATION

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

Licenses/restrictions placed on the data, or limitations of reuse: CC0 1.0
Universal (CC0 1.0)

Recommended citation for the data: Nitta JH, Mishler BD, Iwasaki W, Ebihara A
(2021) Data from: Spatial phylogenetics of Japanese ferns: Patterns, processes,
and implications for conservation FIXME: add DOI when available

Citation for and links to publications that cite or use the data: Nitta JH,
Mishler BD, Iwasaki W, Ebihara A (2021) Spatial phylogenetics of Japanese ferns:
Patterns, processes, and implications for conservation FIXME: add journal when published

Code for analyzing the data is available on github:
https://github.com/joelnitta/japan_ferns_biogeo

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

DATA & FILE OVERVIEW

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

File list (filenames, directory structure (for zipped files) and brief
description of all data files):

- japan_climate.gpkg: Climate data in Japan downloaded from WorldClim database
- japan_ferns_comm_full.csv: Community matrix (species x sites matrix) of ferns in Japan
- japan_ferns_inext_results.csv: Results of collection curve analysis on fern specimens in Japan
- japan_ferns_occ_summary.csv: Summary of specimen data of ferns in Japan
- japan_ferns_redundancy_by_res: Taxonomic richness, abundance, and redunancy at different spatial resolutions for ferns of Japan
- japan_ferns_shape_full.gpkg: Location of grid cells (sites) for ferns in Japan
- japan_ferns_traits_lucid.csv: Morphological trait data of ferns in Japan
- japan_map_points.csv: Latitude and longitude of points used to produce a map of Japan
- japan_protected_areas.gpkg: Protected areas in Japan
- testo_sundue_2016_calibrations.csv: Fossil calibration points used for phylogenetic dating analysis
- results.zip: Analysis results that may be useful in future studies. Files include:
  - japan_ferns_tree_dated.tre: Maximim-likelihood, ultrametric (dated) phylogeny of ferns in Japan
  - japan_ferns_tree.tre: Maximim-likelihood phylogeny of ferns in Japan
  - japan_ferns_traits.csv: Trait matrix of ferns in Japan used for functional biodiversity analysis
  - japan_ferns_comm.csv: Community matrix (species x sites matrix) of ferns in Japan used for biodiversity analysis
  - japan_ferns_biodiv.gpkg: Biodiversity statistics of ferns in Japan
  
Checksums are 32-byte MD5 hashes generated with tools::md5sum() in R.

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

METHODOLOGICAL INFORMATION

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

```{r summary-stats}
# Number of fossils used for dating
n_fossil_points <- plastome_calibration_dates %>%
  filter(age_type != "fixed") %>%
  nrow()
```

Description of methods used for collection/generation of data:

A list of native, non-hybrid fern specimens housed at the herbarium of the
Museum of Science and Nature, Japan was converted to a community data matrix at
four grain sizes (grid cells spanning Japan, each 0.1, 0.2, 0.3, or 0.4 degrees
per side). The original list with latitude and longitude of each specimen is not
included here to protect rare and endangered species. The 0.2 degree grain size
was selected for further analysis based on redundancy (ratio of number of
specimens to number of taxa per cell).

All taxon names are based on the Green List (http://www.rdplants.org/gl/;
English version available at
https://datadryad.org/stash/dataset/doi:10.5061/dryad.4362p32)

Traits were measured on each species as described in @Ebihara2019b.

Phylogenetic analysis was conducted with maximum likelihood in IQ-TREE
[@Nguyen2015] by combining plastid *rbcL* sequences of each taxon with a
globally sampled data matrix (Nitta et al, in prep). Next, dating analysis was
carried out using treePL v1.0 [@Smith2012] with `r n_fossil_points` fossil
calibration points after @Testo2016a. The dated phylogeny was then trimmed to
include Japanese taxa only.

The community matrix, traits, and phylogeny were used to analyze spatial
patterns of phylogenetic diversity and endemism.

Data files were generated from raw data (not included here) using scripts
available at https://github.com/joelnitta/japan_ferns_biogeo.

For full methods, see Nitta JH, Mishler BD, Iwasaki W, Ebihara A (2021) Spatial
phylogenetics of Japanese ferns: Patterns, processes, and implications for
conservation FIXME: Add journal when published

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

DATA-SPECIFIC INFORMATION

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

```{r japan-ferns-comm-full}
japan_ferns_comm_full <- read_csv(here::here(japan_ferns_comm_full_file))
# Check that no data are missing
assert(japan_ferns_comm_full, not_na, everything(), success_fun = success_logical)
```

`r fs::path_file(japan_ferns_comm_full_file)`: Community matrix (species x sites
matrix) of ferns in Japan. Sites correspond to 0.2 degree x 0.2 degree grid
cells covering Japan. For location of grid cells, see
japan_ferns_shape_full.gpkg. Full dataset including all grid cells (none
excluded due to low redundancy).

Number of variables: `r ncol(japan_ferns_comm_full)`

Number of cases/rows: `r nrow(japan_ferns_comm_full)`

Variable list:

- grids: Name of grid cell.
- Other columns: Each column is named for a Japanese fern taxon. 
  Values indicate number of specimens that were observed in each grid cell for that taxon.

Missing data codes: No missing data.

MD5 checksum: `r tools::md5sum(here::here(japan_ferns_comm_full_file))`

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

```{r japan_ferns_inext_results}
inext_res <- read_csv(here::here(inext_res_file))
# Check that no data are missing
assert(inext_res, not_na, everything(), success_fun = success_logical)
```

`r fs::path_file(inext_res_file)`: Output from running iNEXT [@Hsieh2016] on
specimen data for ferns of Japan. iNEXT estimates diversity (here, species
richness) and sampling completeness based on interpolation and extrapolation
from the original data.

Number of variables: `r ncol(inext_res)`

Number of cases/rows: `r nrow(inext_res)`

Variable list:

```{r results = "asis"}
  inext_res %>%
  make_data_desc(
    tribble(
      ~col, ~desc,
      "m", "Sample size (number of individuals)",
      "method", "Method used to estimate diveristy",
      "order", "Diversity order of Hill number (here 0, equivalent to species richness)",
      "qD", "Estimated diversity",
      "qD.LCL", "Lower 95% confidence limit on estimated diversity",
      "qD.UCL", "Upper 95% confidence limit on estimated diversity",
      "SC", "Estimated sampling completeness",
      "SC.LCL", "Lower 95% confidence limit on sampling completeness",
      "SC.UCL", "Upper 95% confidence limit on sampling completeness")
  )
```

Missing data codes: No missing data.

MD5 checksum: `r tools::md5sum(here::here(japan_ferns_comm_full_file))`

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

```{r occ_point_data_summary}
occ_point_data_summary <- read_csv(here::here(occ_point_data_summary_file))
# Check that no data are missing
assert(occ_point_data_summary, not_na, everything(), success_fun = success_logical)
```

`r fs::path_file(occ_point_data_summary_file)`: Summary of raw specimen data for
native, non-hybrid ferns of Japan. Raw specimen data consists of one row per
specimen, with species name, latitude, longitude, and collection date (raw
specimen data not included here to protect endangered species). Raw data were
filtered to remove duplicate specimens and specimens that occurred outside of
the second-degree mesh (approximately 10 km sq grid cell) map of Japan
(http://www.biodic.go.jp/trialSystem/EN/shpddl.html)

Number of variables: `r ncol(occ_point_data_summary)`

Number of cases/rows: `r nrow(occ_point_data_summary)`

Variable list:

```{r results = "asis"}
  occ_point_data_summary %>%
  make_data_desc(
    tribble(
      ~col, ~desc,
      "dataset", "Dataset name. 'occ_point_data_ferns_unfiltered' indicates data includes all specimens; 'occ_point_data_ferns' indicates data only includes specimens after filtering",
      "variable", "Variable. 'n_taxa' indicates number of taxa, 'n_specimens' indicates number of specimens",
      "value", "Value corresponding to each variable")
  )
```

Missing data codes: No missing data.

MD5 checksum: `r tools::md5sum(here::here(occ_point_data_summary_file))`

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

```{r redundancy_by_res}
redundancy_by_res <- read_csv(here::here(redundancy_by_res_file))
# Check that no data are missing
assert(redundancy_by_res, not_na, everything(), success_fun = success_logical)
```

`r fs::path_file(redundancy_by_res_file)`: Results of testing binning raw
specimen data of native, non-hybrid ferns of Japan into grid-cells at different
resolutions. Sampling redundancy is a metric of sampling completeness,
calculated as 1 - (richness/abundance).

Number of variables: `r ncol(redundancy_by_res)`

Number of cases/rows: `r nrow(redundancy_by_res)`

Variable list:

```{r results = "asis"}
  redundancy_by_res %>%
  make_data_desc(
    tribble(
      ~col, ~desc,
      "res", "Degree of resolution (grid-cell side length), from 0.1 to 0.4 degrees",
      "grids", "Name of grid-cell",
      "abundance", "Number of specimens occurring in grid-cell",
      "richness", "Number of taxa occurring in grid-cell",
      "redundancy", "Redundancy (measure of sampling completeness)"
  ))
```

Missing data codes: No missing data.

MD5 checksum: `r tools::md5sum(here::here(redundancy_by_res_file))`

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

```{r japan_ferns_shape_full}
japan_ferns_shape_full <- st_read(here::here(japan_ferns_shape_full_file))
# Check that no data are missing
assert(japan_ferns_shape_full, not_na, everything(), success_fun = success_logical)
```

`r fs::path_file(japan_ferns_shape_full_file)`: Spatial data of native,
non-hybrid ferns in Japan in GeoPackage format. Compiled from raw specimen data
by binning specimens into 0.2 degree grid cells across Japan.

Number of variables: `r ncol(japan_ferns_shape_full)`

Number of cases/rows: `r nrow(japan_ferns_shape_full)`

Variable list:

```{r results = "asis"}
  japan_ferns_shape_full %>%
  make_data_desc(
    tribble(
      ~col, ~desc,
      "grids", "Name of grid-cell",
      "abundance", "Number of specimens occurring in grid-cell",
      "richness", "Number of taxa occurring in grid-cell",
      "redundancy", "Redundancy (measure of sampling completeness)",
      "geom", "Vector describing shape and position of grid-cell"
  ))
```

Missing data codes: No missing data.

MD5 checksum: `r tools::md5sum(here::here(japan_ferns_shape_full_file))`

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

CHANGE LOG

\-\-\-

2021-08-31

Generate this README file.
